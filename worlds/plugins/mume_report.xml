<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Wednesday, June 20, 2012, 4:37 PM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_report" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_report"
   author="Nick Stockton"
   id="16462ef9fabc266dd551efc7"
   language="Lua"
   purpose="Provides aliases for reporting score and needed xp/tp"
   date_written="2012-06-20 16:36:00"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="mume_report"
   match="^points_capture\: (?P&lt;points&gt;[HM]P|MV) (?P&lt;current&gt;[\-]?\d+|xxx)\/(?P&lt;max&gt;\d+|xxx)$"
   name="capture_points"
   omit_from_log="y"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>
local current = tonumber("%&lt;current&gt;")
local max = tonumber("%&lt;max&gt;")
CallPlugin(TTS, "silence")
if not max then
	Note("Unavailable.")
elseif max == 0 then
	Note("Character doesn't have %&lt;points&gt;s.")
else
	Note(string.format("%d/%d [%.0f%%%] %&lt;points&gt;s.", current, max, (current >= 0 and current or 0) / max * 100))
end
  </send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_report"
   match="^(?P&lt;hp&gt;[-\d]+)\/(?P&lt;max_hp&gt;\d+) hits(?:\, (?P&lt;mana&gt;[-\d]+)\/(?P&lt;max_mana&gt;\d+) mana\,)? and (?P&lt;mv&gt;[-\d]+)\/(?P&lt;max_mv&gt;\d+) moves\.$"
   name="capture_score"
   omit_from_log="y"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>score(tonumber("%&lt;hp&gt;"), tonumber("%&lt;max_hp&gt;"), tonumber("%&lt;mana&gt;"), tonumber("%&lt;max_mana&gt;"), tonumber("%&lt;mv&gt;"), tonumber("%&lt;max_mv&gt;"))</send>
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   name="display_hps"
   match="hp"
   enabled="y"
   group="mume_report"
   sequence="100"
  >
  <send>info points_capture: HP %%z/%%Z</send>
  </alias>
  <alias
   name="display_mps"
   match="mp"
   enabled="y"
   group="mume_report"
   sequence="100"
  >
  <send>info points_capture: MP %%e/%%E</send>
  </alias>
  <alias
   name="display_mvs"
   match="mv"
   enabled="y"
   group="mume_report"
   sequence="100"
  >
  <send>info points_capture: MV %%j/%%J</send>
  </alias>
  <alias
   name="report_full"
   match="rpf"
   enabled="y"
   group="mume_report"
   send_to="10"
   sequence="100"
  >
  <send>
rp
rptnl
  </send>
  </alias>
  <alias
   name="report_score"
   match="rp"
   enabled="y"
   group="mume_report"
   send_to="12"
   sequence="100"
  >
  <send>score_report()</send>
  </alias>
</aliases>

<!--  Script  -->


<script>
<![CDATA[
TTS = "925cdd0331023d9f0b8f05a7"

will_report_score = false

function score_report()
	will_report_score = true
	Send("score")
end

function score(hp, max_hp, mana, max_mana, mv, max_mv)
	local points = {}
	table.insert(points, string.format("HP: %s/%s [%.0f%%]", hp, max_hp, (hp >= 0 and hp or 0) / max_hp * 100))
	if max_mana ~= "" and max_mana then
		table.insert(points, string.format("Mana: %s/%s [%.0f%%]", mana, max_mana, (mana >= 0 and mana or 0) / max_mana * 100))
	end
	table.insert(points, string.format("Moves: %s/%s [%.0f%%].", mv, max_mv, (mv >= 0 and mv or 0) / max_mv * 100))
	local output = table.concat(points, ", ")
	Note(output)
	if will_report_score then
		Send("emote reports: ", output)
		will_report_score = false
	end
end

]]>
</script>


</muclient>
