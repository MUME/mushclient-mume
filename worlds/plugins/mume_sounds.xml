<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Monday, March 12, 2012, 9:41 AM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_sounds" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_sounds"
   author="Nick Stockton"
   id="32821ab3fa17b04a8ab4c420"
   language="Lua"
   purpose="Sound triggers for Mume."
   date_written="2012-03-12 09:40:19"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^\*.+(?P&lt;player&gt;Orc|Troll|Man|Woman|Elf|Half-Elf|Dwarf|Hobbit|Bear|Numenorean|Númenórean)\*.*?(?P&lt;action&gt;standing|sitting|resting|sleeping|fighting|riding|nocks a missile|begins some strange|arrived|leaves).+?((?P&lt;direction&gt;north|south|east|west|up|down|above|below|hiding place).*)?$"
   name="pk_action_sounds"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>
local player = "%&lt;player&gt;"
local action = "%&lt;action&gt;"
if player == "Numenorean" or player == "Númenórean" or player == "Woman" then
	player = "Man"
end
if action == "nocks a missile" then
	action = "shooting"
elseif action == "begins some strange" then
	action = "casting"
end
if "%&lt;direction&gt;" ~= "hiding place" then
	play(TYPE_PK, GetInfo(67) .. "sounds/" .. player .. action .. "%&lt;direction&gt;.wav")
end
  </send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^You begin to feel (?P&lt;need&gt;hungry|thirsty)\.$"
   name="hungry_thirsty_sounds"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_ALERT, GetInfo(67) .. "sounds/%&lt;need&gt;.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^You (?:feel a hidden presence\.|smell blood\.|have found [^\!]+\!)$"
   name="Hidden_sound"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_ALERT, GetInfo(67) .. "sounds/hidden.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="You gain a level!"
   name="gain_level_sound"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_ALERT, GetInfo(67) .. "sounds/tada.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^A (?:citizen[\- ])?mercenary (?:(?:leaves|has arrived from) [^\.]+|is here\, (?:looking|waiting) for a job)\.$"
   name="misc_alert1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_ALERT, GetInfo(67) .. "sounds/misc_alert.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^(?:Cirdan the Shipwright|Elrond(?: the Master of Rivendell)?) (?:is standing here \(glowing\)| (?:leaves|has arrived from) [^\.]+)\.$"
   name="misc_alert2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_ALERT, GetInfo(67) .. "sounds/misc_alert.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^(?:A blue transparent wall slowly appears around you|Your magic armour is revitalised)\.$"
   name="armour_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/armour_on.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="You feel less protected."
   name="armour_down"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/armour_off.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^You (?:begin to feel the light of Aman|feel a renewed light) shine upon you\.$"
   name="bless_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/bless_on.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="The light of Aman fades away from you."
   name="bless_down"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/bless_off.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^You(?: feel protected|r protection is revitalised)\.$"
   name="shield_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/shield_on.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="Your magical shield wears off."
   name="shield_down"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/shield_off.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^(?:You feel stronger|The duration of the strength spell has been improved)\.$"
   name="strength_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/strength_on.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="You feel weaker."
   name="strength_down"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/strength_off.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^You(?: feel your awareness improve|r awareness is refreshed)\.$"
   name="sense_life_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/sense_life_on.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="You feel less aware of your surroundings."
   name="sense_life_down"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/sense_life_off.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^(?:An energy begins to flow within your legs as your body becomes lighter|The energy in your legs is refreshed)\.$"
   name="breath_of_briskness_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/breath_of_briskness_on.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="Your legs feel heavier."
   name="breath_of_briskness_down"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/breath_of_briskness_off.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^(?:You start glowing|Your aura glows more intensely)\.$"
   name="sanctuary_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/sanctuary_on.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="The white aura around your body fades."
   name="sanctuary_down"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/sanctuary_off.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="You have been blinded!"
   name="blindness_up"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/blindness_on.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="You feel a cloak of blindness dissolve."
   name="blindness_down"
   omit_from_output="y"
   send_to="14"
   sequence="100"
  >
  <send>play(TYPE_SPELL_STATUS, GetInfo(67) .. "sounds/spells/blindness_off.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^(?:As you call upon Elbereth\, [^\.]+? shivers in pain|[^\.]+? is dissolved by your goodness)\.$"
   name="dispel_evil_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/dispel_evil_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="You raise your hand and an icy wind starts to blow through the room."
   name="fear_target"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/fear_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^You(?:r spray of light rips [^\,]+? apart completely\, killing \w+| spray [^\.]+? with many\-coloured rays of bright light)\.$"
   name="colour_spray_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/colour_spray_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^You burn(?:ed)? [^\.]+\.$"
   name="burning_hands_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/burning_hands_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^Your fireball (?:completely envelops [^\.]+? in flames|hits [^\,]+? with full force\, causing an immediate death)\.$"
   name="fireball_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/fireball_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^The (?:impact of your lightning bolt kills [^\.]+|lightning bolt hits [^\.]+? with full impact)\.$"
   name="lightning_bolt_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/lightning_bolt_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="The earth trembles beneath your feet!"
   name="earthquake"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/earthquake.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^[^\!]+? seems to be blinded\!$"
   name="blind_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/blind_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="Your victim is already blind."
   name="already_blind_target"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/spells/already_blind_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^(?:[^\.]+? swiftly dodges your attempt to shoot \w+|You try to shoot [^\,]+\, but \w+ parries successfully|Your attempt to shoot [^\.]+? fails)\.$"
   name="fail_shoot_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/combat/fail_shoot_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^You (?:barely |lightly |strongly )?shoot [^\.]+\.$"
   name="shoot_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/combat/shoot_target.wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^[^\.]+? makes a strange sound(?: but is suddenly very silent)?\, as you place a[n]? [^\.]+? in \w+ back\.$"
   name="backstab_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/skills/backstab/" .. math.random(1, 7) .. ".wav")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_sounds"
   match="^(?:[^\.]+? easily avoids your backstab\.|Oops\, your victim (?:caught you by surprise|seems to have sensed a danger)\!)$"
   name="fail_backstab_target"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play(TYPE_SPELL_ATTACK, GetInfo(67) .. "sounds/skills/backstab/fail_backstab_target.wav")</send>
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
CONFIG = "d19a2f0a604c96b7318aa67f"
TTS = "925cdd0331023d9f0b8f05a7"
TYPE_ALERT = 3
TYPE_SPELL_ATTACK = 4
TYPE_SPELL_STATUS = 5
TYPE_PK = 8
TYPE_COMMUNICATION = 9

return_code, sound_volume = CallPlugin(CONFIG, "get", "sound_volume")
sound_volume = sound_volume or 0
return_code, sound_mute = CallPlugin(CONFIG, "get", "sound_mute")
sound_mute = sound_mute or false

math.randomseed(os.time())

function toggle_mute()
	sound_mute = not sound_mute
	CallPlugin(CONFIG, "set", "sound_mute", sound_mute)
	CallPlugin(TTS, "say", string.format("%sMuted", sound_mute and "" or "Un"), true)
end

function adjust_volume(value)
	local volume = sound_volume + value
	CallPlugin(TTS, "silence")
	if sound_mute then
		sound_mute = false
		CallPlugin(CONFIG, "set", "sound_mute", sound_mute)
		CallPlugin(TTS, "say", "UnMuted", false)
	end
	if volume < -100 then
		volume = -100
	elseif volume > 0 then
		volume = 0
	end
	sound_volume = volume
	CallPlugin(CONFIG, "set", "sound_volume", sound_volume)
	CallPlugin(TTS, "say", string.format("%dDB volume.", sound_volume), false)
end

function play(sound_type, file_name)
	if not sound_mute then
		PlaySound(sound_type, file_name, false, sound_volume, 0)
	end
end

function OnPluginInstall()
	SetOption("play_sounds_in_background", 1)
end

]]>
</script>


</muclient>
