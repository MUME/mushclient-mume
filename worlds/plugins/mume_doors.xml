<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Tuesday, June 19, 2012, 9:15 PM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_doors" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_doors"
   author="Nick Stockton"
   id="8d6f0aa8ea88d5fc6f5e07d1"
   language="Lua"
   purpose="Aliases for handling doors, and auto open doors when you run in to them."
   date_written="2012-06-19 21:12:02"
   requires="4.70"
   version="1.1"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="mume_doors"
   match="^The (\w+) seem[s]? to be closed\.$"
   name="auto_open"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>
if auto_open then
	Send("open %1")
end
  </send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_doors"
   match="^(?:You skillfully discover a hidden (\w+)|The (\w+) (?:is|are) (?:open|closed))\.$"
   name="auto_set_door"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>
if auto_open then
	-- door_name = "%1"
end
  </send>
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   name="door_action"
   match="^d(?P&lt;action&gt;[bcklopru])\s*(?P&lt;direction&gt;[neswud])?$"
   enabled="y"
   group="mume_doors"
   regexp="y"
   ignore_case="y"
   send_to="12"
   sequence="100"
  >
  <send>
local action = DOOR_ACTIONS[string.lower("%&lt;action&gt;")]
local direction = string.lower("%&lt;direction&gt;")
if door_name ~= "" then
	Send(string.format("%s %s %s", action, door_name, direction))
else
	Send(string.format("secretaction %s %s", action, direction))
end
  </send>
  </alias>
  <alias
   name="door_set"
   match="^door(?:\s+(?P&lt;name&gt;.*))?$"
   enabled="y"
   group="mume_doors"
   regexp="y"
   ignore_case="y"
   send_to="12"
   sequence="100"
  >
  <send>
if "%&lt;name&gt;" == "" then
	if door_name == "" then
		CallPlugin(TTS, "sayNote", "Door undefined.")
	else
		CallPlugin(TTS, "sayNote", string.format("%s is set.", door_name))
	end
else
	if string.sub("clear", 1, #"%&lt;name&gt;") == string.lower("%&lt;name&gt;") then
		door_name = ""
		CallPlugin(TTS, "sayNote", "Door cleared.")
	else
		door_name = "%&lt;name&gt;"
		CallPlugin(TTS, "sayNote", "%&lt;name&gt; set.")
	end
end
  </send>
  </alias>
  <alias
   name="toggle_auto_open"
   match="autoopen"
   enabled="y"
   group="mume_doors"
   regexp="y"
   ignore_case="y"
   send_to="12"
   sequence="100"
  >
  <send>
auto_open = auto_open ~= true
CallPlugin(TTS, "sayNote", string.format("Auto open doors %s.", auto_open and "yes" or "no"))
  </send>
  </alias>
</aliases>

<!--  Script  -->


<script>
<![CDATA[
TTS = "925cdd0331023d9f0b8f05a7"
DOOR_ACTIONS = {
	["b"] = "bash",
	["c"] = "close",
	["k"] = "cast 'block door'",
	["l"] = "lock",
	["o"] = "open",
	["p"] = "pick",
	["r"] = "cast 'break door'",
	["u"] = "unlock"
}

auto_open = true
door_name = ""

]]>
</script>


</muclient>
