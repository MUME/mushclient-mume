<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Sunday, September 09, 2012, 9:56 AM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_macros" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_macros"
   author="Nick Stockton"
   id="a0a9837c5486a08f13defd7a"
   language="Lua"
   purpose="Defines keyboard macros to be used while playing mume."
   date_written="2012-09-09 09:55:17"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Script  -->


<script>
<![CDATA[
require("mystdlib")
TTS = "925cdd0331023d9f0b8f05a7"
CONFIG = "d19a2f0a604c96b7318aa67f"
MUME_CASTOR_SPELL_TRANSLATOR = "8b4e5dd676d8477dc5f14376"
MUME_SOUNDS = "32821ab3fa17b04a8ab4c420"
MUME_HUNTING = "d54f37916d74ac326debe33f"
XML_PARSER = "74834d3734b2c8a3a9da4d18"

repeat_commands = {}
local return_code, keyboard_layout = CallPlugin(CONFIG, "get", "keyboard_layout")


if keyboard_layout == "dvorak" then
	Accelerator("Alt+C", "north")
	Accelerator("Alt+T", "south")
	Accelerator("Alt+N", "east")
	Accelerator("Alt+H", "west")
	Accelerator("Alt+G", "up")
	Accelerator("Alt+R", "down")
	Accelerator("Alt+shift+C", "scout north")
	Accelerator("Alt+shift+T", "scout south")
	Accelerator("Alt+shift+N", "scout east")
	Accelerator("Alt+shift+H", "scout west")
	Accelerator("Alt+shift+G", "scout up")
	Accelerator("Alt+shift+R", "scout down")
	AcceleratorTo("alt+S", "speak_xml_event('name')", sendto.script)
	AcceleratorTo("alt+I", "speak_xml_event('buffer')", sendto.script)
	AcceleratorTo("alt+U", "speak_xml_event('fighting')", sendto.script)
	AcceleratorTo("alt+E", "speak_xml_event('hp')", sendto.script)
	AcceleratorTo("alt+O", "speak_xml_event('mp')", sendto.script)
	AcceleratorTo("alt+A", "speak_xml_event('mv')", sendto.script)
	AcceleratorTo("alt+;", "speak_xml_event('light')", sendto.script)
	AcceleratorTo("alt+Q", "speak_xml_event('terrain')", sendto.script)
	AcceleratorTo("alt+J", "speak_xml_event('fought')", sendto.script)
	AcceleratorTo("alt+K", "speak_xml_event('flags')", sendto.script)
	AcceleratorTo("alt+X", "speak_xml_event('sneak')", sendto.script)
	AcceleratorTo("alt+'", "repeat_command(1)", sendto.script)
	AcceleratorTo("alt+shift+'", "set_repeat(1, GetCommand()); SelectCommand(); PasteCommand('')", sendto.script)
	AcceleratorTo("alt+,", "repeat_command(2)", sendto.script)
	AcceleratorTo("alt+shift+,", "set_repeat(2, GetCommand()); SelectCommand(); PasteCommand('')", sendto.script)
	AcceleratorTo("alt+.", "repeat_command(3)", sendto.script)
	AcceleratorTo("alt+shift+.", "set_repeat(3, GetCommand()); SelectCommand(); PasteCommand('')", sendto.script)
	AcceleratorTo("alt+P", "repeat_command(4)", sendto.script)
	AcceleratorTo("alt+shift+P", "set_repeat(4, GetCommand()); SelectCommand(); PasteCommand('')", sendto.script)
else
	Accelerator("Alt+I", "north")
	Accelerator("Alt+K", "south")
	Accelerator("Alt+L", "east")
	Accelerator("Alt+J", "west")
	Accelerator("Alt+U", "up")
	Accelerator("Alt+O", "down")
	Accelerator("Alt+shift+I", "scout north")
	Accelerator("Alt+shift+K", "scout south")
	Accelerator("Alt+shift+L", "scout east")
	Accelerator("Alt+shift+J", "scout west")
	Accelerator("Alt+shift+U", "scout up")
	Accelerator("Alt+shift+O", "scout down")
	AcceleratorTo("alt+;", "speak_xml_event('name')", sendto.script)
	AcceleratorTo("alt+G", "speak_xml_event('buffer')", sendto.script)
	AcceleratorTo("alt+F", "speak_xml_event('fighting')", sendto.script)
	AcceleratorTo("alt+D", "speak_xml_event('hp')", sendto.script)
	AcceleratorTo("alt+S", "speak_xml_event('mp')", sendto.script)
	AcceleratorTo("alt+A", "speak_xml_event('mv')", sendto.script)
	AcceleratorTo("alt+Z", "speak_xml_event('light')", sendto.script)
	AcceleratorTo("alt+X", "speak_xml_event('terrain')", sendto.script)
	AcceleratorTo("alt+C", "speak_xml_event('fought')", sendto.script)
	AcceleratorTo("alt+V", "speak_xml_event('flags')", sendto.script)
	AcceleratorTo("alt+B", "speak_xml_event('sneak')", sendto.script)
	AcceleratorTo("alt+Q", "repeat_command(1)", sendto.script)
	AcceleratorTo("alt+shift+Q", "set_repeat(1, GetCommand()); SelectCommand(); PasteCommand('')", sendto.script)
	AcceleratorTo("alt+W", "repeat_command(2)", sendto.script)
	AcceleratorTo("alt+shift+W", "set_repeat(2, GetCommand()); SelectCommand(); PasteCommand('')", sendto.script)
	AcceleratorTo("alt+E", "repeat_command(3)", sendto.script)
	AcceleratorTo("alt+shift+E", "set_repeat(3, GetCommand()); SelectCommand(); PasteCommand('')", sendto.script)
	AcceleratorTo("alt+R", "repeat_command(4)", sendto.script)
	AcceleratorTo("alt+shift+R", "set_repeat(4, GetCommand()); SelectCommand(); PasteCommand('')", sendto.script)
end

for i = 1, 9 do
	AcceleratorTo("alt+" .. tostring(i), string.format("CallPlugin(MUME_HUNTING, 'do_action_instance', 1, 1, %d)", i), sendto.script)
	AcceleratorTo("alt+shift+" .. tostring(i), string.format("CallPlugin(MUME_HUNTING, 'do_action_instance', 1, 2, %d)", i), sendto.script)
	AcceleratorTo("ctrl+" .. tostring(i), string.format("CallPlugin(MUME_HUNTING, 'do_action_instance', 2, 1, %d)", i), sendto.script)
	AcceleratorTo("ctrl+shift+" .. tostring(i), string.format("CallPlugin(MUME_HUNTING, 'do_action_instance', 2, 2, %d)", i), sendto.script)
end
AcceleratorTo("alt+0", "CallPlugin(MUME_HUNTING, 'do_action_instance', 1, 1, 10)", sendto.script)
AcceleratorTo("alt+shift+0", "CallPlugin(MUME_HUNTING, 'do_action_instance', 1, 2, 10)", sendto.script)
AcceleratorTo("ctrl+0", "CallPlugin(MUME_HUNTING, 'do_action_instance', 2, 1, 10)", sendto.script)
AcceleratorTo("ctrl+shift+0", "CallPlugin(MUME_HUNTING, 'do_action_instance', 2, 2, 10)", sendto.script)

Accelerator("ctrl+M", "assist")
Accelerator("ctrl+B", "bash")
Accelerator("ctrl+H", "shoot")
AcceleratorTo ("ctrl+U", "SelectCommand(); PasteCommand(''); CallPlugin(TTS, 'say', 'Cleared')", sendto.script)
AcceleratorTo("ctrl+I", "CallPlugin(MUME_CASTOR_SPELL_TRANSLATOR, 'toggle_casting_interrupt')", sendto.script)
AcceleratorTo("F12", "CallPlugin(MUME_SOUNDS, 'adjust_volume', 1)", sendto.script)
AcceleratorTo("shift+F12", "CallPlugin(MUME_SOUNDS, 'adjust_volume', -1)", sendto.script)
AcceleratorTo("ctrl+shift+F12", "CallPlugin(MUME_SOUNDS, 'toggle_mute')", sendto.script)
AcceleratorTo("ctrl+Space", "pause_toggle()", sendto.script)

function pause_toggle()
	local paused = GetInfo(114)
	paused = not paused
	CallPlugin(TTS, "say", paused and "pause" or "unpause", true)
	Pause(paused)
	if not paused then
		-- Scroll to end and leave scroll bar visibility unchanged.
		SetScroll(-1, GetInfo(120))
	end
end

function set_repeat(number, command)
	local command = string.strip(command)
	if command == "" then
		if repeat_commands[number] then
			Note("'", repeat_commands[number], "' is repeated.")
		else
			Note("Repeat command not set.")
		end
	elseif command == "clear" then
		repeat_commands[number] = nil
		Note("Cleared.")
	else
		repeat_commands[number] = command
		Note("'", repeat_commands[number], "' now repeated.")
	end
end

function repeat_command(number)
	-- local command = repeat_commands[number] or GetCommandList(1)[1]
	if repeat_commands[number] then
		Execute(repeat_commands[number])
	else
		Note("No repeat command.")
	end
end

function speak_xml_event(key)
	local return_code, value = CallPlugin(XML_PARSER, "get", key)
	if not value or value == "" then
		value = key == "name" and "No room name" or "Unknown"
	end
	CallPlugin(TTS, "say", value, true)
end

]]>
</script>


</muclient>
