<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Monday, March 12, 2012, 11:18 AM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_xp_counter" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_xp_counter"
   author="Nick Stockton"
   id="b84e490e3bdfca04b01eb410"
   language="Lua"
   purpose="Keeps track of the xp and tp that you receive on Mume."
   date_written="2012-03-12 11:17:05"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Aliases  -->

<aliases>
  <alias
   name="display_xp_info"
   match="xp"
   enabled="y"
   group="mume_xp_counter"
   omit_from_log="y"
   send_to="12"
   sequence="100"
  >
  <send>xpDisplay()</send>
  </alias>
</aliases>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="mume_xp_counter"
   keep_evaluating="y"
   match="^(?:You are dead\! Sorry\.\.|Reconnecting|Welcome to the land of Middle-earth\. May your visit here be\.\.\. interesting)\.$"
   name="reset"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>session_xp = 0
session_tp = 0
old_xp = 0
old_tp = 0
Send("info XPCOUNTER: %x %t %X %T.")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_xp_counter"
   match="You receive your share of experience."
   name="gained_xp"
   omit_from_output="y"
   send_to="13"
   sequence="100"
  >
  <send>info XPCOUNTER: %x %t %X %T.</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_xp_counter"
   omit_from_log="y"
   match="^XPCOUNTER: (?P&lt;xp&gt;\d+) (?P&lt;tp&gt;\d+) (?P&lt;needed_xp&gt;\d+) (?P&lt;needed_tp&gt;\d+)\.$"
   name="parse_xp_info_line"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>xpUpdate(tonumber("%&lt;xp&gt;"), tonumber("%&lt;tp&gt;"), tonumber("%&lt;needed_xp&gt;"), tonumber("%&lt;needed_tp&gt;"))
xpDisplay()</send>
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
screenReader = "925cdd0331023d9f0b8f05a7"
gained_xp = 0
gained_tp = 0
session_xp = 0
session_tp = 0
needed_xp = 0
needed_tp = 0
old_xp = 0
old_tp = 0

function xpUpdate(updated_xp, updated_tp, updated_needed_xp, updated_needed_tp)
	if old_xp~=0 or nil then
		gained_xp = updated_xp - old_xp
	end
	if old_tp~=0 or nil then
		gained_tp = updated_tp - old_tp
	end
	session_xp = session_xp + gained_xp
	session_tp = session_tp + gained_tp
	old_xp = updated_xp
	old_tp = updated_tp
	needed_xp = updated_needed_xp
	needed_tp = updated_needed_tp
end

function xpDisplay()
	CallPlugin(screenReader, "sayNote", "--> Gained  xp: "..tostring(gained_xp).."\t\ttp: "..tostring(gained_tp))
	CallPlugin(screenReader, "sayNote", "--> Session xp: "..tostring(session_xp).."\t\ttp: "..tostring(session_tp))
	CallPlugin(screenReader, "sayNote", "--> Needed  xp: "..tostring(needed_xp).."\t\ttp: "..tostring(needed_tp))
end

]]>
</script>

</muclient>
