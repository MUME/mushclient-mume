<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Monday, March 12, 2012, 11:18 AM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_xp_counter" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_xp_counter"
   author="Nick Stockton"
   id="b84e490e3bdfca04b01eb410"
   language="Lua"
   purpose="Keeps track of the xp and tp that you receive on Mume."
   date_written="2012-03-12 11:17:05"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Aliases  -->

<aliases>
  <alias
   name="display_xp_info"
   match="xp"
   enabled="y"
   group="mume_xp_counter"
   omit_from_log="y"
   send_to="12"
   sequence="100"
  >
  <send>xp_display()</send>
  </alias>
  <alias
   name="display_tps"
   match="tp"
   enabled="y"
   group="mume_xp_counter"
   omit_from_log="y"
   send_to="12"
   sequence="100"
  >
  <send>Send("info TPCOUNTER: %t %T.")</send>
  </alias>
</aliases>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="mume_xp_counter"
   match="^(?:You are dead\! Sorry\.\.|Reconnecting|Welcome to the land of Middle-earth\. May your visit here be\.\.\. interesting)\.$"
   name="reset"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>
session_xp = 0
session_tp = 0
old_xp = 0
old_tp = 0
Send("info XPCOUNTER: %x %t %X %T.")
  </send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_xp_counter"
   match="You receive your share of experience."
   name="gained_xp"
   omit_from_output="y"
   sequence="100"
  >
  <send>info XPCOUNTER: %x %t %X %T.</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_xp_counter"
   omit_from_log="y"
   match="^XPCOUNTER\: (?P&lt;xp&gt;\d+) (?P&lt;tp&gt;\d+) (?P&lt;needed_xp&gt;\d+) (?P&lt;needed_tp&gt;\d+)\.$"
   name="parse_xp_info_line"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>
gained_xp = tonumber("%&lt;xp&gt;") - old_xp
gained_tp = tonumber("%&lt;tp&gt;") - old_tp
session_xp = session_xp + gained_xp
session_tp = session_tp + gained_tp
old_xp = tonumber("%&lt;xp&gt;")
old_tp = tonumber("%&lt;tp&gt;")
needed_xp = tonumber("%&lt;needed_xp&gt;")
needed_tp = tonumber("%&lt;needed_tp&gt;")
xp_display()
  </send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_xp_counter"
   omit_from_log="y"
   match="^TPCOUNTER\: (?P&lt;tp&gt;\d+) (?P&lt;needed_tp&gt;\d+)\.$"
   name="parse_tp_info_line"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>
gained_tp = tonumber("%&lt;tp&gt;") - old_tp
session_tp = session_tp + gained_tp
old_tp = tonumber("%&lt;tp&gt;")
needed_tp = tonumber("%&lt;needed_tp&gt;")
Note(string.format("Gained: %s, Session: %s, Needed: %s, Total: %&lt;tp&gt;", gained_tp, session_tp, needed_tp))
  </send>
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
local gained_xp = 0
local gained_tp = 0
local session_xp = 0
local session_tp = 0
local needed_xp = 0
local needed_tp = 0
local old_xp = 0
local old_tp = 0

function xp_display()
	Note("Gained XP: ", tostring(gained_xp), ", TP: ", tostring(gained_tp))
	Note("Session XP: ", tostring(session_xp), ", TP: ", tostring(session_tp))
	Note("Needed XP: ", tostring(needed_xp), ", TP: ", tostring(needed_tp))
end

]]>
</script>

</muclient>
