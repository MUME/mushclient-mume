<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Saturday, June 20, 2015, 7:27 AM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_spell_timers" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_spell_timers"
   author="Nick Stockton"
   id="884c711be2e31aedf0a02f11"
   language="Lua"
   purpose="Keeps track of how long spells have been up for."
   date_written="2015-06-20 07:27:25"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:A blue transparent wall slowly appears around you|Your magic armour is revitalised)\.$"
   name="armour_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("armour")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel less protected."
   name="armour_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("armour")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="Your eyes tingle."
   name="detect_invisibility_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("detect invisibility")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="The detect invisible wears off."
   name="detect_invisibility_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("detect invisibility")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You (?:begin to feel the light of Aman|feel a renewed light) shine upon you\.$"
   name="bless_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("bless")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="The light of Aman fades away from you."
   name="bless_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("bless")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You(?: feel protected|r protection is revitalised)\.$"
   name="shield_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("shield")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="Your magical shield wears off."
   name="shield_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("shield")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You feel stronger|The duration of the strength spell has been improved)\.$"
   name="strength_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("strength")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel weaker."
   name="strength_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("strength")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You are surrounded by a misty shroud|Your misty shroud is renewed)\.$"
   name="shroud_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("shroud")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel yourself exposed."
   name="shroud_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("shroud")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You(?: feel your awareness improve|r awareness is refreshed)\.$"
   name="sense_life_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("sense life")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel less aware of your surroundings."
   name="sense_life_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("sense life")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:An energy begins to flow within your legs as your body becomes lighter|The energy in your legs is refreshed)\.$"
   name="breath_of_briskness_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("breath of briskness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="Your legs feel heavier."
   name="breath_of_briskness_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("breath of briskness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You start glowing|Your aura glows more intensely)\.$"
   name="sanctuary_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("sanctuary")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="The white aura around your body fades."
   name="sanctuary_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("sanctuary")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You (?:have a righteous feeling\!|feel a renewed righteousness\.)$"
   name="protection_from_evil_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("protection from evil")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel less righteous."
   name="protection_from_evil_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("protection from evil")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You(?: feel aware of all that is foul and evil|r awareness of evil is refreshed)\.$"
   name="detect_evil_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("detect evil")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You sense the red in your vision disappear."
   name="detect_evil_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("detect evil")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You(?: become sensitive of magical auras|r awareness of magical auras is renewed)\.$"
   name="detect_magic_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("detect magic")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="Your perception of magical auras wears off."
   name="detect_magic_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("detect magic")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^Your (?:eyes tingle|night vision is refreshed)\.$"
   name="night_vision_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("night vision")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="Your vision blurs."
   name="night_vision_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("night vision")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel very sleepy... zzzzzz"
   name="sleep_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("sleep")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel less tired."
   name="sleep_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("sleep")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel your muscles relax and your pulse slow as the strength that welled within you subsides."
   name="tiredness_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("tiredness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel your muscles regain some of their former energy."
   name="tiredness_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("tiredness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel a sudden flash of dizziness causing you to pause before getting your directional bearings back."
   name="haggardness_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("haggardness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel steadier now."
   name="haggardness_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("haggardness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel a sudden loss of energy as the power that once mingled with your own vanishes."
   name="lethargy_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("lethargy")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel your magic energy coming back to you."
   name="lethargy_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("lethargy")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You have been blinded!"
   name="blindness_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("blindness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel a cloak of blindness dissolve."
   name="blindness_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("blindness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="Alas, you realise that yet again the mighty knowledge of drowned Numenor has been lost... Despair settles on you."
   name="depression_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("depression")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="Your heart feels lighter."
   name="depression_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("depression")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="Hearing the horn blow, you feel your urge to battle increase!"
   name="battleglory_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("battleglory")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="You feel your newfound strength leaving you again."
   name="battleglory_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("battleglory")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="The draught burns down your throat, and a fiery feeling fills your limbs."
   name="orkish_draught_up"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_set("orkish draught")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="As the warmth of the draught recedes from your limbs, you feel less energetic."
   name="orkish_draught_down"
   send_to="12"
   sequence="100"
  >
  <send>spell_timer_unset("orkish draught")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^\- (?P&lt;spell&gt;armour|bless|shield|strength|shroud|sense life|breath of briskness|sanctuary|protection from evil|detect evil|detect magic|detect invisibility|night vision|tiredness|haggardness|lethargy|blindness|depression|battleglory|Orkish draught|sleep)$"
   name="spell_status"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>spell_timer_status("%&lt;spell&gt;")</send>
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
local spell_timers = {}

function spell_timer_set(spell)
	spell_timers[spell] = os.time()
end

function spell_timer_status(spell)
	if spell_timers[spell] then
		local current_time = os.time()
		local minutes = math.floor((current_time - spell_timers[spell]) / 60)
		local minutes_pretty = minutes ~= 1 and "s" or ""
		local seconds = math.floor((current_time - spell_timers[spell]) % 60)
		local seconds_pretty = seconds ~= 1 and "s" or ""
		Note(string.format("%s up for %d minute%s, %d second%s.", spell, minutes, minutes_pretty, seconds, seconds_pretty))
	else
		Note(spell)
	end
end

function spell_timer_unset(spell)
	if spell_timers[spell] then
		spell_timer_status(spell)
		spell_timers[spell] = nil
	end
end

]]>
</script>


</muclient>
