<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Saturday, June 20, 2015, 7:27 AM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_spell_timers" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_spell_timers"
   author="Nick Stockton"
   id="884c711be2e31aedf0a02f11"
   language="Lua"
   purpose="Keeps track of how long spells have been up for."
   date_written="2015-06-20 07:27:25"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:A blue transparent wall slowly appears around you|Your magic armour is revitalized)\.$"
   name="armour_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("armour")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel less protected\.$"
   name="armour_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("armour", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You begin to feel the light of Aman shine upon you|You feel a renewed light shine upon you)\.$"
   name="bless_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("bless")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^The light of Aman fades away from you\.$"
   name="bless_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("bless", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You feel protected|Your protection is revitalized)\.$"
   name="shield_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("shield")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^Your magical shield wears off\.$"
   name="shield_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("shield", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You feel stronger|The duration of the strength spell has been improved)\.$"
   name="strength_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("strength")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel weaker\.$"
   name="strength_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("strength", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You are surrounded by a misty shroud|Your misty shroud is renewed)\.$"
   name="shroud_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("shroud")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel yourself exposed\.$"
   name="shroud_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("shroud", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You feel your awareness improve|Your awareness is refreshed)\.$"
   name="sense_life_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("sense life")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel less aware of your surroundings\.$"
   name="sense_life_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("sense life", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:An energy begins to flow within your legs as your body becomes lighter|The energy in your legs is refreshed)\.$"
   name="breath_of_briskness_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("breath of briskness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^Your legs feel heavier\.$"
   name="breath_of_briskness_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("breath of briskness", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You start glowing|Your aura glows more intensely)\.$"
   name="sanctuary_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("sanctuary")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^The white aura around your body fades\.$"
   name="sanctuary_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("sanctuary", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You have a righteous feeling\!|You feel a renewed righteousness\.)$"
   name="protection_from_evil_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("protection from evil")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel less righteous\.$"
   name="protection_from_evil_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("protection from evil", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You feel aware of all that is foul and evil|Your awareness of evil is refreshed)\.$"
   name="detect_evil_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("detect evil")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You sense the red in your vision disappear\.$"
   name="detect_evil_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("detect evil", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:You become sensitive of magical auras|Your awareness of magical auras is renewed)\.$"
   name="detect_magic_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("detect magic")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^Your perception of magical auras wears off\.$"
   name="detect_magic_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("detect magic", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^(?:Your eyes tingle|Your night vision is refreshed)\.$"
   name="night_vision_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("night vision")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^Your vision blurs\.$"
   name="night_vision_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("night vision", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel your muscles relax and your pulse slow as the strength that welled within you subsides\.$"
   name="tiredness_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("tiredness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel your muscles regain some of their former energy\.$"
   name="tiredness_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("tiredness", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel a sudden flash of dizziness causing you to pause before getting your directional bearings back\.$"
   name="haggardness_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("haggardness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel steadier now\.$"
   name="haggardness_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("haggardness", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel a sudden loss of energy as the power that once mingled with your own has now vanished\.$"
   name="lethargy_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("lethargy")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel your magic energy coming back to you\.$"
   name="lethargy_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("lethargy", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You have been blinded\!$"
   name="blindness_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("blindness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel a cloak of blindness dissolve\.$"
   name="blindness_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("blindness", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^Hearing the horn blow\, you feel your urge to battle increase\!$"
   name="battleglory_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("battleglory")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^You feel your newfound strength leaving you again\.$"
   name="battleglory_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("battleglory", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^The draught burns down your throat, and a fiery feeling fills your limbs\.$"
   name="orkish_draught_up"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerSet("orkish draught")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^As the warmth of the draught recedes from your limbs, you feel less energetic\.$"
   name="orkish_draught_down"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerUnset("orkish draught", "%0")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_spell_timers"
   match="^- (?P&lt;spell&gt;armour|bless|shield|strength|shroud|sense life|breath of briskness|sanctuary|protection from evil|detect evil|detect magic|night vision|tiredness|haggardness|lethargy|blindness|battleglory|Orkish draught)$"
   name="spell_status"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>spellTimerStatus("%&lt;spell&gt;")</send>
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
screenReader = "925cdd0331023d9f0b8f05a7"
spellTimers = {}

function spellTimerSet(spell)
	spellTimers[spell] = os.time()
end

function spellTimerStatus(spell)
	if spellTimers[spell] then
		local currentTime = os.time()
		local minutes = math.floor((currentTime - spellTimers[spell]) / 60)
		local minutesPretty = minutes ~= 1 and "s" or ""
		local seconds = math.floor((currentTime - spellTimers[spell]) % 60)
		local secondsPretty = seconds ~= 1 and "s" or ""
		CallPlugin(screenReader, "sayNote", string.format("%s up for %d minute%s, %d second%s.", spell, minutes, minutesPretty, seconds, secondsPretty))
	else
		CallPlugin(screenReader, "sayNote", spell)
	end
end

function spellTimerUnset(spell, line)
	CallPlugin(screenReader, "sayNote", line)
	if spellTimers[spell] then
		spellTimerStatus(spell)
		spellTimers[spell] = nil
	end
end

]]>
</script>


</muclient>
