<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- This Source Code Form is subject to the terms of the Mozilla Public -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- Saved on Sunday, August 19, 2012, 9:41 AM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "mume_reentering" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mume_reentering"
   author="Nick Stockton"
   id="630ffb28e267d3e40bb756e1"
   language="Lua"
   purpose="Allows the player to reenter the room they just fled or escaped out of."
   date_written="2012-08-19 09:39:01"
   requires="4.70"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="mume_reentering"
   match="You flee head over heels."
   name="gag_flee_message"
   omit_from_output="y"
   sequence="100"
  >
  </trigger>
  <trigger
   enabled="y"
   group="mume_reentering"
   match="You seek to escape..."
   name="gag_escape_message"
   omit_from_output="y"
   sequence="100"
  >
  </trigger>
  <trigger
   enabled="y"
   group="mume_reentering"
   match="^PANIC\! You (couldn\'t escape|can\'t quit the fight)\!$"
   name="Shorten_panic_message"
   omit_from_output="y"
   regexp="y"
   send_to="2"
   sequence="100"
  >
  <send>Panic!</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_reentering"
   match="^You flee (?P&lt;direction&gt;north|south|east|west|up|down)\.$"
   name="fleeing"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>fled_direction = "%&lt;direction&gt;"
CallPlugin(TTS, "silence")
Note(string.format("%s!", fled_direction))
</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_reentering"
   match="You failed to escape the fight!"
   name="fail_escape"
   omit_from_output="y"
   send_to="14"
   sequence="100"
  >
  <send>CallPlugin(TTS, "silence")
Note("Failed!")
</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_reentering"
   match="You successfully escaped the fight!"
   name="successful_escape"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>CallPlugin(TTS, "silence")</send>
  </trigger>
  <trigger
   enabled="y"
   group="mume_reentering"
   match="You feel stealthy again."
   name="stealthy_again"
   omit_from_output="y"
   send_to="14"
   sequence="100"
  >
  <send>CallPlugin(TTS, "silence")
Note("Stealthy!")
  </send>
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   name="escape_south"
   match="ss"
   enabled="y"
   group="mume_reentering"
   send_to="12"
   sequence="100"
  >
  <send>Send("escape south")
fled_direction = "south"</send>
  </alias>
  <alias
   name="escape_down"
   match="dd"
   enabled="y"
   group="mume_reentering"
   send_to="12"
   sequence="100"
  >
  <send>Send("escape down")
fled_direction = "down"</send>
  </alias>
  <alias
   name="escape_east"
   match="ee"
   enabled="y"
   group="mume_reentering"
   send_to="12"
   sequence="100"
  >
  <send>Send("escape east")
fled_direction = "east"</send>
  </alias>
  <alias
   name="escape_north"
   match="nn"
   enabled="y"
   group="mume_reentering"
   send_to="12"
   sequence="100"
  >
  <send>Send("escape north")
fled_direction = "north"</send>
  </alias>
  <alias
   name="reenter_room"
   match="v"
   enabled="y"
   group="mume_reentering"
   send_to="12"
   sequence="100"
  >
  <send>reenter()</send>
  </alias>
  <alias
   name="escape_up"
   match="uu"
   enabled="y"
   group="mume_reentering"
   send_to="12"
   sequence="100"
  >
  <send>Send("escape up")
fled_direction = "up"</send>
  </alias>
  <alias
   name="escape_west"
   match="ww"
   enabled="y"
   group="mume_reentering"
   send_to="12"
   sequence="100"
  >
  <send>Send("escape west")
fled_direction = "west"</send>
  </alias>
</aliases>

<!--  Script  -->


<script>
<![CDATA[
TTS = "925cdd0331023d9f0b8f05a7"
REVERSE_DIRECTIONS = {
	north="south",
	south="north",
	east="west",
	west="east",
	up="down",
	down="up",
}

fled_direction = ""

function reenter()
	if REVERSE_DIRECTIONS[fled_direction] then
		Send(REVERSE_DIRECTIONS[fled_direction])
	end
	fled_direction = ""
end

]]>
</script>


</muclient>
